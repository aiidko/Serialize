Реализовал через задание сериализации/десериализации в конкретном классе.
Это противоречит условиям задачи, но реализовать через рефлекшен не успел.
Если будут какие-то вопросы, готовы ответить.
